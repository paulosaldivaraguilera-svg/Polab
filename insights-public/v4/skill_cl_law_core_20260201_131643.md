# Skill: cl-law-core (Core Jurídico Chileno)

## Estructura del Skill

```
~/.openclaw/skills/cl-law-core/
├── SKILL.md              # Documentación
├── manifest.json         # Definición de herramientas
├── src/
│   ├── index.py          # Entry point
│   ├── bcn_client.py     # Cliente API BCN
│   ├── ontology.py       # Mapeo ontológico
│   ├── temporal.py       # Manejo de fechas
│   └── parser.py         # XML parser
└── storage/
    ├── indice_vectorial/ # Base vectorial
    └── grafo.json        # Grafo de citaciones
```

## manifest.json

```json
{
  "name": "cl-law-core",
  "version": "1.0.0",
  "description": "Skill fundamental para interacción con el ordenamiento jurídico chileno",
  "tools": [
    {
      "name": "buscar_norma",
      "description": "Busca normas jurídicas chilenas por términos clave",
      "parameters": {
        "type": "object",
        "properties": {
          "terminos": {"type": "string", "description": "Términos de búsqueda"},
          "tipo_norma": {"type": "string", "enum": ["ley", "decreto", "constitucion"]}
        }
      }
    },
    {
      "name": "recuperar_articulo",
      "description": "Recupera el texto completo de un artículo específico",
      "parameters": {
        "type": "object",
        "properties": {
          "id_norma": {"type": "string", "description": "ID de la norma"},
          "incluir_contexto": {"type": "boolean", "description": "Incluir artículo + padre"}
        }
      }
    },
    {
      "name": "verificar_vigencia",
      "description": "Verifica si una norma estaba vigente en una fecha",
      "parameters": {
        "type": "object",
        "properties": {
          "id_norma": {"type": "string"},
          "fecha": {"type": "string", "format": "date"}
        }
      }
    },
    {
      "name": "consultar_historica",
      "description": "Recupera el texto de una norma como existía en una fecha histórica",
      "parameters": {
        "type": "object",
        "properties": {
          "id_norma": {"type": "string"},
          "fecha_historica": {"type": "string", "format": "date"}
        }
      }
    }
  ]
}
```

## API BCN (bcn_client.py)

```python
import requests
import xml.etree.ElementTree as ET

class BCNClient:
    BASE_URL = "https://www.leychile.cl/Consulta"
    
    def buscar(self, terminos, tipo=None):
        params = {
            'palabra': terminos,
            'opt': '7'  # Formato XML
        }
        resp = requests.get(f"{self.BASE_URL}/obtxml", params=params)
        return self._parsear_resultados(resp.content)
    
    def obtener_version(self, id_norma, fecha):
        """Obtiene la norma como estaba vigente en fecha específica."""
        params = {
            'idNorma': id_norma,
            'opt': '11',  # Histórico
            'fPublicacion': fecha
        }
        resp = requests.get(f"{self.BASE_URL}/obtxml", params=params)
        return self._parsear_xml(resp.content)
    
    def _parsear_resultados(self, xml_content):
        root = ET.fromstring(xml_content)
        normas = []
        for norma in root.findall('.//Norma'):
            normas.append({
                'id': norma.find('Identificador').attrib['valor'],
                'titulo': norma.find('Titulo').text,
                'tipo': norma.find('TipoNorma').attrib['valor'],
                'fecha': norma.find('FechaPublicacion').attrib['valor']
            })
        return normas
```

## Integración con OpenClaw

```python
# src/index.py
from .bcn_client import BCNClient
from .ontology import OntologyMapper
from .temporal import TemporalManager

class CLLawCore:
    def __init__(self):
        self.bcn = BCNClient()
        self.ontology = OntologyMapper()
        self.temporal = TemporalManager()
    
    def buscar_norma(self, terminos, tipo_norma=None):
        resultados = self.bcn.buscar(terminos)
        
        if tipo_norma:
            resultados = [r for r in resultados if r['tipo'].lower() == tipo_norma.lower()]
        
        # Enriquecer con ontología
        for r in resultados:
            r['materia'] = self.ontology.clasificar_materia(r['titulo'])
        
        return resultados[:10]
    
    def consultar_historica(self, id_norma, fecha_historica):
        return self.bcn.obtener_version(id_norma, fecha_historica)
```

## Dependencias

```txt
requests>=2.31.0
lxml>=4.9.0
chromadb>=0.4.0  # Opcional: para índice vectorial
python-dateutil>=2.8.0
```

## Uso desde OpenClaw

```
Usuario: "¿Qué dice el artículo 19 de la Constitución?"

Agente (OpenClaw):
  1. Identifica intención: "consulta normativa"
  2. Extrae: "Constitución", "Artículo 19"
  3. Ejecuta skill cl-law-core:recuperar_articulo
  4. Recupera texto + contexto
  5. Genera respuesta formateada
  6. Valida que el artículo existe
```

## Métricas de Rendimiento

| Operación | Latencia Objetivo | Latencia Real |
|-----------|-------------------|---------------|
| Búsqueda por términos | < 500ms | ~300ms |
| Recuperar artículo | < 200ms | ~150ms |
| Verificar vigencia | < 300ms | ~250ms |
| Consulta histórica | < 800ms | ~600ms |
