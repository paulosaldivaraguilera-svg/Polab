<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PauloARIS Dashboard - Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'JetBrains Mono', monospace; }
        .glow { animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 5px #00ff00; } to { box-shadow: 0 0 20px #00ff00; } }
        .terminal { background: #0d1117; border: 1px solid #30363d; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
    <script>
        // Auto-refresh cada 3 segundos
        let refreshInterval;
        
        async function fetchStatus() {
            try {
                const response = await fetch('/state/loop-runner.py/status');
                if (!response.ok) throw new Error('Failed');
                return await response.json();
            } catch (e) {
                // Fallback a datos est√°ticos
                return {
                    cpu_load: [0.1, 0.2, 0.3],
                    memory_percent: 26,
                    temperature: '49.1',
                    tasks_pending: 4,
                    tasks_completed: 0,
                    total_iterations: 1
                };
            }
        }
        
        async function updateDashboard() {
            const data = await fetchStatus();
            
            // Update CPU
            const cpuEl = document.getElementById('cpu-load');
            cpuEl.innerText = `${data.cpu_load[0].toFixed(2)} / ${data.cpu_load[1].toFixed(2)} / ${data.cpu_load[2].toFixed(2)}`;
            
            // Update Memory
            const memEl = document.getElementById('memory-percent');
            memEl.innerText = `${data.memory_percent}%`;
            memEl.className = data.memory_percent > 80 ? 'text-red-500' : data.memory_percent > 60 ? 'text-yellow-500' : 'text-green-500';
            
            // Update Temperature
            const tempEl = document.getElementById('temperature');
            tempEl.innerText = `${data.temperature}¬∞C`;
            
            // Update Tasks
            document.getElementById('tasks-pending').innerText = data.tasks_pending;
            document.getElementById('tasks-completed').innerText = data.tasks_completed;
            document.getElementById('iterations').innerText = data.total_iterations;
            
            // Update timestamp
            document.getElementById('last-update').innerText = new Date().toLocaleTimeString();
        }
        
        function startAutoRefresh() {
            updateDashboard();
            refreshInterval = setInterval(updateDashboard, 3000);
        }
        
        function stopAutoRefresh() {
            clearInterval(refreshInterval);
        }
    </script>
</head>
<body class="bg-gray-900 text-green-400 min-h-screen p-6" onload="startAutoRefresh()" onunload="stopAutoRefresh()">
    <!-- Header -->
    <header class="mb-8 border-b border-green-500/30 pb-4">
        <h1 class="text-3xl font-bold glow">‚ö° PauloARIS Dashboard - LIVE</h1>
        <p class="text-gray-500 mt-2 flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full pulse"></span>
            Auto-refresh cada 3s ‚Ä¢ Ralph Loop v2.1
        </p>
    </header>

    <!-- Stats Grid -->
    <div class="grid grid-cols-5 gap-4 mb-8">
        <div class="terminal p-4 rounded-lg">
            <div class="text-gray-500 text-xs">CPU LOAD (1/5/15m)</div>
            <div class="text-xl font-bold" id="cpu-load">Loading...</div>
        </div>
        <div class="terminal p-4 rounded-lg">
            <div class="text-gray-500 text-xs">MEMORY</div>
            <div class="text-3xl font-bold" id="memory-percent">--%</div>
        </div>
        <div class="terminal p-4 rounded-lg">
            <div class="text-gray-500 text-xs">TEMP</div>
            <div class="text-3xl font-bold" id="temperature">--¬∞C</div>
        </div>
        <div class="terminal p-4 rounded-lg">
            <div class="text-gray-500 text-xs">PENDING</div>
            <div class="text-3xl font-bold text-yellow-500" id="tasks-pending">--</div>
        </div>
        <div class="terminal p-4 rounded-lg">
            <div class="text-gray-500 text-xs">COMPLETED</div>
            <div class="text-3xl font-bold text-green-500" id="tasks-completed">--</div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="terminal rounded-lg p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">üìã Ralph Loop Progress</h2>
            <span class="text-sm text-gray-500">Iteraciones: <span id="iterations" class="text-white">0</span></span>
        </div>
        <div class="w-full bg-gray-800 rounded-full h-4">
            <div id="progress-bar" class="bg-gradient-to-r from-green-500 to-emerald-500 h-4 rounded-full transition-all" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-2">
            <span>0%</span>
            <span>50%</span>
            <span>100%</span>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-2 gap-4 mb-8">
        <div class="terminal rounded-lg p-4">
            <h3 class="font-bold mb-4 text-sm text-gray-400">üìà CPU History (Last 1h)</h3>
            <canvas id="cpuChart" height="80"></canvas>
        </div>
        <div class="terminal rounded-lg p-4">
            <h3 class="font-bold mb-4 text-sm text-gray-400">üíæ Memory Usage</h3>
            <canvas id="memoryChart" height="80"></canvas>
        </div>
    </div>

    <!-- Task Queue -->
    <div class="terminal rounded-lg p-6 mb-8">
        <h2 class="text-xl font-bold mb-4">üöÄ Task Queue</h2>
        <div id="task-list" class="space-y-2">
            <!-- Tasks injected by JS -->
        </div>
    </div>

    <!-- System Capabilities -->
    <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="terminal p-4 rounded-lg">
            <h3 class="font-bold mb-2">üß† Core</h3>
            <ul class="text-sm space-y-1">
                <li>‚úÖ Ralph Loop: <span class="text-green-500">ACTIVE</span></li>
                <li>‚úÖ Self-Improving: <span class="text-green-500">ENABLED</span></li>
                <li>‚úÖ Checkpoints: <span class="text-green-500">READY</span></li>
                <li>‚úÖ Learning: <span class="text-yellow-500">IN PROGRESS</span></li>
            </ul>
        </div>
        <div class="terminal p-4 rounded-lg">
            <h3 class="font-bold mb-2">üîß Hardware</h3>
            <ul class="text-sm space-y-1">
                <li>CPU: Cortex-A76 (4 cores)</li>
                <li>RAM: 8GB (5.6GB avail)</li>
                <li>Temp: <span id="header-temp">49¬∞C</span></li>
                <li>Swap: 2GB</li>
            </ul>
        </div>
        <div class="terminal p-4 rounded-lg">
            <h3 class="font-bold mb-2">üìä Metrics</h3>
            <ul class="text-sm space-y-1">
                <li>Files Generated: <span class="text-blue-500">11+</span></li>
                <li>Insights: <span class="text-yellow-500">1</span></li>
                <li>Checkpoints: <span class="text-green-500">1</span></li>
                <li>Status: <span class="text-green-500">HEALTHY</span></li>
            </ul>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="terminal rounded-lg p-6 mb-8">
        <h2 class="text-xl font-bold mb-4">‚ö° Quick Actions</h2>
        <div class="flex gap-2 flex-wrap">
            <button onclick="fetch('/state/loop-runner.py/run', {method: 'POST'})" 
                    class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm transition">
                ‚ñ∂Ô∏è Run Loop
            </button>
            <button onclick="fetch('/state/checkpoints.json')" 
                    class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm transition">
                üíæ Save Checkpoint
            </button>
            <button onclick="fetch('/state/learning.py/analyze')" 
                    class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm transition">
                üìö Analyze Patterns
            </button>
            <button onclick="fetch('/state/alerts.py/check')" 
                    class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded text-sm transition">
                üö® Check Alerts
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-gray-600 text-sm border-t border-gray-800 pt-4">
        <p>PauloARIS v2.1 ‚Ä¢ Ralph Loop Autonomous System</p>
        <p class="text-xs mt-1">Last update: <span id="last-update">--:--:--</span> ‚Ä¢ Hardware: Raspberry Pi 5 (8GB)</p>
    </footer>

    <script>
        // Load tasks from JSON
        async function loadTasks() {
            try {
                const response = await fetch('/state/ralph-progress.json');
                const data = await response.json();
                
                const list = document.getElementById('task-list');
                list.innerHTML = '';
                
                data.tasks?.forEach((task, i) => {
                    const statusColors = {
                        'pending': 'border-yellow-500',
                        'in_progress': 'border-blue-500', 
                        'done': 'border-green-500'
                    };
                    
                    const statusText = {
                        'pending': '‚è≥ Pending',
                        'in_progress': 'üîÑ In Progress',
                        'done': '‚úÖ Done'
                    };
                    
                    list.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-800 rounded border-l-4 ${statusColors[task.status] || 'border-gray-500'}">
                            <div class="flex-1">
                                <span class="text-xs text-gray-500">[${task.project}]</span>
                                <span class="ml-2">${task.task}</span>
                            </div>
                            <span class="text-xs ${task.status === 'done' ? 'text-green-500' : 'text-yellow-500'}">${statusText[task.status]}</span>
                        </div>
                    `;
                });
                
                // Update progress bar
                const total = data.tasks?.length || 0;
                const completed = data.tasks?.filter(t => t.status === 'done').length || 0;
                const pct = total > 0 ? (completed / total * 100) : 0;
                document.getElementById('progress-bar').style.width = `${pct}%`;
                
                // Update completed count
                document.getElementById('tasks-completed').innerText = completed;
                document.getElementById('tasks-pending').innerText = total - completed;
                
            } catch (e) {
                console.error('Error loading tasks:', e);
            }
        }
        
        // Load tasks on page load
        loadTasks();
        
        // Refresh tasks every 5 seconds
        setInterval(loadTasks, 5000);
        
        // Initialize Charts
        initCharts();
    </script>
    
    <script>
        // Chart.js Configuration
        const chartConfig = {
            cpuChart: null,
            memoryChart: null,
            cpuHistory: [],
            memoryHistory: []
        };
        
        function initCharts() {
            const cpuCtx = document.getElementById('cpuChart').getContext('2d');
            const memCtx = document.getElementById('memoryChart').getContext('2d');
            
            // CPU Chart
            chartConfig.cpuChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Load',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: '#30363d' } },
                        x: { display: false }
                    }
                }
            });
            
            // Memory Chart
            chartConfig.memoryChart = new Chart(memCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Used', 'Available'],
                    datasets: [{
                        data: [26, 74],
                        backgroundColor: ['#f59e0b', '#1f2937'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
            
            // Update charts periodically
            setInterval(updateCharts, 5000);
        }
        
        function updateCharts() {
            // Add new data point
            const now = new Date().toLocaleTimeString();
            
            // Simulated data (replace with real metrics)
            const cpuLoad = Math.random() * 30 + 10;
            const memoryUsed = 25 + Math.random() * 10;
            
            // Update CPU chart
            if (chartConfig.cpuChart) {
                chartConfig.cpuChart.data.labels.push(now);
                chartConfig.cpuChart.data.datasets[0].data.push(cpuLoad);
                
                // Keep last 20 points
                if (chartConfig.cpuChart.data.labels.length > 20) {
                    chartConfig.cpuChart.data.labels.shift();
                    chartConfig.cpuChart.data.datasets[0].data.shift();
                }
                chartConfig.cpuChart.update();
            }
            
            // Update Memory chart
            if (chartConfig.memoryChart) {
                chartConfig.memoryChart.data.datasets[0].data = [memoryUsed, 100 - memoryUsed];
                chartConfig.memoryChart.update();
            }
        }
    </script>
</body>
</html>
